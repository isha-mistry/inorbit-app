#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

branch="$(git symbolic-ref --short HEAD)"

if [ "$branch" = "main-v2.0.0" ]; then
  if [ "$BYPASS_PROTECTED" != "true" ]; then
    echo "🚫 Direct push to $branch is not allowed. Please use a feature branch."
    echo "👉 To bypass (only for emergencies), run: BYPASS_PROTECTED=true git push"
    exit 1
  else
    echo "⚠️ Bypass active: Pushing directly to $branch"
  fi
fi


echo "📦 Running build..."
yarn build
if [ $? -ne 0 ]; then
  echo "❌ Build failed. Fix the issues before pushing."
  exit 1
fi
